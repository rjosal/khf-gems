<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: PhusionPassenger::AbstractRequestHandler</title>

  <link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

  <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../lib/phusion_passenger/abstract_request_handler_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/phusion_passenger/abstract_request_handler.rb">lib/phusion_passenger/abstract_request_handler.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"><a href="../Object.html">Object</a></p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-i-cleanup">#cleanup</a></li>
          
          <li><a href="#method-i-main_loop">#main_loop</a></li>
          
          <li><a href="#method-i-main_loop_running-3F">#main_loop_running?</a></li>
          
          <li><a href="#method-i-soft_shutdown">#soft_shutdown</a></li>
          
          <li><a href="#method-i-start_main_loop_thread">#start_main_loop_thread</a></li>
          
        </ul>
      </div>
      

      
      <!-- Included Modules -->
      <div id="includes-section" class="section">
        <h3 class="section-header">Included Modules</h3>
        <ul class="link-list">
        
        
          <li><a class="include" href="DebugLogging.html">PhusionPassenger::DebugLogging</a></li>
        
        
        
          <li><a class="include" href="Utils.html">PhusionPassenger::Utils</a></li>
        
        
        </ul>
      </div>
      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="../README.html">README</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../PhusionPassenger.html">PhusionPassenger</a></li>
        
          <li><a href="../PhusionPassenger/AbstractInstaller.html">PhusionPassenger::AbstractInstaller</a></li>
        
          <li><a href="../PhusionPassenger/AbstractRequestHandler.html">PhusionPassenger::AbstractRequestHandler</a></li>
        
          <li><a href="../PhusionPassenger/AbstractServer.html">PhusionPassenger::AbstractServer</a></li>
        
          <li><a href="../PhusionPassenger/AbstractServer/InvalidPassword.html">PhusionPassenger::AbstractServer::InvalidPassword</a></li>
        
          <li><a href="../PhusionPassenger/AbstractServer/ServerAlreadyStarted.html">PhusionPassenger::AbstractServer::ServerAlreadyStarted</a></li>
        
          <li><a href="../PhusionPassenger/AbstractServer/ServerError.html">PhusionPassenger::AbstractServer::ServerError</a></li>
        
          <li><a href="../PhusionPassenger/AbstractServer/ServerNotStarted.html">PhusionPassenger::AbstractServer::ServerNotStarted</a></li>
        
          <li><a href="../PhusionPassenger/AbstractServer/UnknownMessage.html">PhusionPassenger::AbstractServer::UnknownMessage</a></li>
        
          <li><a href="../PhusionPassenger/AbstractServerCollection.html">PhusionPassenger::AbstractServerCollection</a></li>
        
          <li><a href="../PhusionPassenger/AdminTools.html">PhusionPassenger::AdminTools</a></li>
        
          <li><a href="../PhusionPassenger/AdminTools/MemoryStats.html">PhusionPassenger::AdminTools::MemoryStats</a></li>
        
          <li><a href="../PhusionPassenger/AdminTools/MemoryStats/Process.html">PhusionPassenger::AdminTools::MemoryStats::Process</a></li>
        
          <li><a href="../PhusionPassenger/AdminTools/ServerInstance.html">PhusionPassenger::AdminTools::ServerInstance</a></li>
        
          <li><a href="../PhusionPassenger/AdminTools/ServerInstance/CorruptedDirectoryError.html">PhusionPassenger::AdminTools::ServerInstance::CorruptedDirectoryError</a></li>
        
          <li><a href="../PhusionPassenger/AdminTools/ServerInstance/GenerationsAbsentError.html">PhusionPassenger::AdminTools::ServerInstance::GenerationsAbsentError</a></li>
        
          <li><a href="../PhusionPassenger/AdminTools/ServerInstance/Group.html">PhusionPassenger::AdminTools::ServerInstance::Group</a></li>
        
          <li><a href="../PhusionPassenger/AdminTools/ServerInstance/Process.html">PhusionPassenger::AdminTools::ServerInstance::Process</a></li>
        
          <li><a href="../PhusionPassenger/AdminTools/ServerInstance/RoleDeniedError.html">PhusionPassenger::AdminTools::ServerInstance::RoleDeniedError</a></li>
        
          <li><a href="../PhusionPassenger/AdminTools/ServerInstance/StaleDirectoryError.html">PhusionPassenger::AdminTools::ServerInstance::StaleDirectoryError</a></li>
        
          <li><a href="../PhusionPassenger/AdminTools/ServerInstance/Stats.html">PhusionPassenger::AdminTools::ServerInstance::Stats</a></li>
        
          <li><a href="../PhusionPassenger/AdminTools/ServerInstance/UnsupportedGenerationStructureVersionError.html">PhusionPassenger::AdminTools::ServerInstance::UnsupportedGenerationStructureVersionError</a></li>
        
          <li><a href="../PhusionPassenger/AnalyticsLogger.html">PhusionPassenger::AnalyticsLogger</a></li>
        
          <li><a href="../PhusionPassenger/AnalyticsLogger/Lock.html">PhusionPassenger::AnalyticsLogger::Lock</a></li>
        
          <li><a href="../PhusionPassenger/AnalyticsLogger/Log.html">PhusionPassenger::AnalyticsLogger::Log</a></li>
        
          <li><a href="../PhusionPassenger/AnalyticsLogger/SharedData.html">PhusionPassenger::AnalyticsLogger::SharedData</a></li>
        
          <li><a href="../PhusionPassenger/AppInitError.html">PhusionPassenger::AppInitError</a></li>
        
          <li><a href="../PhusionPassenger/AppProcess.html">PhusionPassenger::AppProcess</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRails.html">PhusionPassenger::ClassicRails</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRails/ApplicationSpawner.html">PhusionPassenger::ClassicRails::ApplicationSpawner</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRails/ApplicationSpawner/Error.html">PhusionPassenger::ClassicRails::ApplicationSpawner::Error</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRails/CGIFixed.html">PhusionPassenger::ClassicRails::CGIFixed</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRails/FrameworkSpawner.html">PhusionPassenger::ClassicRails::FrameworkSpawner</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRails/FrameworkSpawner/Error.html">PhusionPassenger::ClassicRails::FrameworkSpawner::Error</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRails/RequestHandler.html">PhusionPassenger::ClassicRails::RequestHandler</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRailsExtensions.html">PhusionPassenger::ClassicRailsExtensions</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRailsExtensions/AnalyticsLogging.html">PhusionPassenger::ClassicRailsExtensions::AnalyticsLogging</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRailsExtensions/AnalyticsLogging/ACBaseExtension.html">PhusionPassenger::ClassicRailsExtensions::AnalyticsLogging::ACBaseExtension</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRailsExtensions/AnalyticsLogging/ACBenchmarkingExtension.html">PhusionPassenger::ClassicRailsExtensions::AnalyticsLogging::ACBenchmarkingExtension</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRailsExtensions/AnalyticsLogging/ACRescueExtension.html">PhusionPassenger::ClassicRailsExtensions::AnalyticsLogging::ACRescueExtension</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRailsExtensions/AnalyticsLogging/ARAbstractAdapterExtension.html">PhusionPassenger::ClassicRailsExtensions::AnalyticsLogging::ARAbstractAdapterExtension</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRailsExtensions/AnalyticsLogging/AVBenchmarkHelperExtension.html">PhusionPassenger::ClassicRailsExtensions::AnalyticsLogging::AVBenchmarkHelperExtension</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRailsExtensions/AnalyticsLogging/CacheStoreExtension.html">PhusionPassenger::ClassicRailsExtensions::AnalyticsLogging::CacheStoreExtension</a></li>
        
          <li><a href="../PhusionPassenger/ClassicRailsExtensions/AnalyticsLogging/ConcreteCacheStoreExtension.html">PhusionPassenger::ClassicRailsExtensions::AnalyticsLogging::ConcreteCacheStoreExtension</a></li>
        
          <li><a href="../PhusionPassenger/ConsoleTextTemplate.html">PhusionPassenger::ConsoleTextTemplate</a></li>
        
          <li><a href="../PhusionPassenger/DebugLogging.html">PhusionPassenger::DebugLogging</a></li>
        
          <li><a href="../PhusionPassenger/FrameworkInitError.html">PhusionPassenger::FrameworkInitError</a></li>
        
          <li><a href="../PhusionPassenger/HTMLTemplate.html">PhusionPassenger::HTMLTemplate</a></li>
        
          <li><a href="../PhusionPassenger/InitializationError.html">PhusionPassenger::InitializationError</a></li>
        
          <li><a href="../PhusionPassenger/InvalidPath.html">PhusionPassenger::InvalidPath</a></li>
        
          <li><a href="../PhusionPassenger/MessageChannel.html">PhusionPassenger::MessageChannel</a></li>
        
          <li><a href="../PhusionPassenger/MessageChannel/InvalidHashError.html">PhusionPassenger::MessageChannel::InvalidHashError</a></li>
        
          <li><a href="../PhusionPassenger/MessageClient.html">PhusionPassenger::MessageClient</a></li>
        
          <li><a href="../PhusionPassenger/NativeSupportLoader.html">PhusionPassenger::NativeSupportLoader</a></li>
        
          <li><a href="../PhusionPassenger/Packaging.html">PhusionPassenger::Packaging</a></li>
        
          <li><a href="../PhusionPassenger/PlatformInfo.html">PhusionPassenger::PlatformInfo</a></li>
        
          <li><a href="../PhusionPassenger/PlatformInfo/RuntimeError.html">PhusionPassenger::PlatformInfo::RuntimeError</a></li>
        
          <li><a href="../PhusionPassenger/Plugin.html">PhusionPassenger::Plugin</a></li>
        
          <li><a href="../PhusionPassenger/Rack.html">PhusionPassenger::Rack</a></li>
        
          <li><a href="../PhusionPassenger/Rack/ApplicationSpawner.html">PhusionPassenger::Rack::ApplicationSpawner</a></li>
        
          <li><a href="../PhusionPassenger/Rack/ApplicationSpawner/Error.html">PhusionPassenger::Rack::ApplicationSpawner::Error</a></li>
        
          <li><a href="../PhusionPassenger/Rack/RequestHandler.html">PhusionPassenger::Rack::RequestHandler</a></li>
        
          <li><a href="../PhusionPassenger/Rails3Extensions.html">PhusionPassenger::Rails3Extensions</a></li>
        
          <li><a href="../PhusionPassenger/Rails3Extensions/AnalyticsLogging.html">PhusionPassenger::Rails3Extensions::AnalyticsLogging</a></li>
        
          <li><a href="../PhusionPassenger/Rails3Extensions/AnalyticsLogging/ACExtension.html">PhusionPassenger::Rails3Extensions::AnalyticsLogging::ACExtension</a></li>
        
          <li><a href="../PhusionPassenger/Rails3Extensions/AnalyticsLogging/ASBenchmarkableExtension.html">PhusionPassenger::Rails3Extensions::AnalyticsLogging::ASBenchmarkableExtension</a></li>
        
          <li><a href="../PhusionPassenger/Rails3Extensions/AnalyticsLogging/ExceptionLogger.html">PhusionPassenger::Rails3Extensions::AnalyticsLogging::ExceptionLogger</a></li>
        
          <li><a href="../PhusionPassenger/SpawnManager.html">PhusionPassenger::SpawnManager</a></li>
        
          <li><a href="../PhusionPassenger/Standalone.html">PhusionPassenger::Standalone</a></li>
        
          <li><a href="../PhusionPassenger/Standalone/AppFinder.html">PhusionPassenger::Standalone::AppFinder</a></li>
        
          <li><a href="../PhusionPassenger/Standalone/Command.html">PhusionPassenger::Standalone::Command</a></li>
        
          <li><a href="../PhusionPassenger/Standalone/ConfigFile.html">PhusionPassenger::Standalone::ConfigFile</a></li>
        
          <li><a href="../PhusionPassenger/Standalone/ConfigFile/DisallowedContextError.html">PhusionPassenger::Standalone::ConfigFile::DisallowedContextError</a></li>
        
          <li><a href="../PhusionPassenger/Standalone/HelpCommand.html">PhusionPassenger::Standalone::HelpCommand</a></li>
        
          <li><a href="../PhusionPassenger/Standalone/Main.html">PhusionPassenger::Standalone::Main</a></li>
        
          <li><a href="../PhusionPassenger/Standalone/PackageRuntimeCommand.html">PhusionPassenger::Standalone::PackageRuntimeCommand</a></li>
        
          <li><a href="../PhusionPassenger/Standalone/RuntimeInstaller.html">PhusionPassenger::Standalone::RuntimeInstaller</a></li>
        
          <li><a href="../PhusionPassenger/Standalone/StartCommand.html">PhusionPassenger::Standalone::StartCommand</a></li>
        
          <li><a href="../PhusionPassenger/Standalone/StatusCommand.html">PhusionPassenger::Standalone::StatusCommand</a></li>
        
          <li><a href="../PhusionPassenger/Standalone/StopCommand.html">PhusionPassenger::Standalone::StopCommand</a></li>
        
          <li><a href="../PhusionPassenger/Standalone/Utils.html">PhusionPassenger::Standalone::Utils</a></li>
        
          <li><a href="../PhusionPassenger/Standalone/VersionCommand.html">PhusionPassenger::Standalone::VersionCommand</a></li>
        
          <li><a href="../PhusionPassenger/UnknownError.html">PhusionPassenger::UnknownError</a></li>
        
          <li><a href="../PhusionPassenger/Utils.html">PhusionPassenger::Utils</a></li>
        
          <li><a href="../PhusionPassenger/Utils/FileSystemWatcher.html">PhusionPassenger::Utils::FileSystemWatcher</a></li>
        
          <li><a href="../PhusionPassenger/Utils/FileSystemWatcher/DirInfo.html">PhusionPassenger::Utils::FileSystemWatcher::DirInfo</a></li>
        
          <li><a href="../PhusionPassenger/Utils/FileSystemWatcher/FileInfo.html">PhusionPassenger::Utils::FileSystemWatcher::FileInfo</a></li>
        
          <li><a href="../PhusionPassenger/Utils/HostsFileParser.html">PhusionPassenger::Utils::HostsFileParser</a></li>
        
          <li><a href="../PhusionPassenger/Utils/Kernel.html">PhusionPassenger::Utils::Kernel</a></li>
        
          <li><a href="../PhusionPassenger/Utils/PseudoIO.html">PhusionPassenger::Utils::PseudoIO</a></li>
        
          <li><a href="../PhusionPassenger/Utils/RewindableInput.html">PhusionPassenger::Utils::RewindableInput</a></li>
        
          <li><a href="../PhusionPassenger/Utils/RewindableInput/Tempfile.html">PhusionPassenger::Utils::RewindableInput::Tempfile</a></li>
        
          <li><a href="../PhusionPassenger/Utils/UnseekableSocket.html">PhusionPassenger::Utils::UnseekableSocket</a></li>
        
          <li><a href="../PhusionPassenger/VersionNotFound.html">PhusionPassenger::VersionNotFound</a></li>
        
          <li><a href="../PhusionPassenger/WSGI.html">PhusionPassenger::WSGI</a></li>
        
          <li><a href="../PhusionPassenger/WSGI/ApplicationSpawner.html">PhusionPassenger::WSGI::ApplicationSpawner</a></li>
        
          <li><a href="../ConditionVariable.html">ConditionVariable</a></li>
        
          <li><a href="../Exception.html">Exception</a></li>
        
          <li><a href="../GC.html">GC</a></li>
        
          <li><a href="../IO.html">IO</a></li>
        
          <li><a href="../Object.html">Object</a></li>
        
          <li><a href="../Process.html">Process</a></li>
        
          <li><a href="../Signal.html">Signal</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">PhusionPassenger::AbstractRequestHandler</h1>

    <div id="description" class="description">
      
<p>The request handler is the layer which connects Apache with the underlying
application’s request dispatcher (i.e. either Rails’s Dispatcher class
or <a href="Rack.html">Rack</a>). The request handler’s job is to process
incoming HTTP requests using the currently loaded Ruby on Rails
application. HTTP requests are forwarded to the request handler by the web
server. HTTP responses generated by the RoR application are forwarded to
the web server, which, in turn, sends the response back to the HTTP client.</p>

<p><a href="AbstractRequestHandler.html">AbstractRequestHandler</a> is an
abstract base class for easing the implementation of request handlers for
Rails and <a href="Rack.html">Rack</a>.</p>

<h2>Design decisions</h2>

<p>Some design decisions are made because we want to decrease system
administrator maintenance overhead. These decisions are documented in this
section.</p>

<h3>Owner pipes</h3>

<p>Because only the web server communicates directly with a request handler,
we want the request handler to exit if the web server has also exited. This
is implemented by using a so-called _owner pipe_. The writable part of the
pipe will be passed to the web server* via a Unix socket, and the web
server will own that part of the pipe, while <a
href="AbstractRequestHandler.html">AbstractRequestHandler</a> owns the
readable part of the pipe. <a
href="AbstractRequestHandler.html">AbstractRequestHandler</a> will
continuously check whether the other side of the pipe has been closed. If
so, then it knows that the web server has exited, and so the request
handler will exit as well. This works even if the web server gets killed by
SIGKILL.</p>
<ul><li>
<p>It might also be passed to the ApplicationPoolServerExecutable, if the web
server’s using ApplicationPoolServer instead of StandardApplicationPool.</p>
</li></ul>

<h2>Request format</h2>

<p>Incoming “HTTP requests” are not true HTTP requests, i.e. their binary
representation do not conform to RFC 2616. Instead, the request format is
based on CGI, and is similar to that of SCGI.</p>

<p>The format consists of 3 parts:</p>
<ul><li>
<p>A 32-bit big-endian integer, containing the size of the transformed
headers.</p>
</li><li>
<p>The transformed HTTP headers.</p>
</li><li>
<p>The verbatim (untransformed) HTTP request body.</p>
</li></ul>

<p>HTTP headers are transformed to a format that satisfies the following
grammar:</p>

<pre>headers ::= header*
header ::= name NUL value NUL
name ::= notnull+
value ::= notnull+
notnull ::= &quot;\x01&quot; | &quot;\x02&quot; | &quot;\x02&quot; | ... | &quot;\xFF&quot;
NUL = &quot;\x00&quot;</pre>

<p>The web server transforms the HTTP request to the aforementioned format,
and sends it to the request handler.</p>

    </div><!-- description -->

    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      
      <!-- Constants -->
      <div id="constants-list" class="section">
        <h3 class="section-header">Constants</h3>
        <dl>
        
          <dt><a name="BACKLOG_SIZE">BACKLOG_SIZE</a></dt>
          
          <dd class="description"></dd>
          
        
          <dt><a name="GC_SUPPORTS_CLEAR_STATS">GC_SUPPORTS_CLEAR_STATS</a></dt>
          
          <dd class="description"></dd>
          
        
          <dt><a name="GC_SUPPORTS_TIME">GC_SUPPORTS_TIME</a></dt>
          
          <dd class="description"></dd>
          
        
          <dt><a name="HARD_TERMINATION_SIGNAL">HARD_TERMINATION_SIGNAL</a></dt>
          
          <dd class="description"><p><a href="../Signal.html">Signal</a> which will cause the Rails application
to exit immediately.</p></dd>
          
        
          <dt><a name="MAX_HEADER_SIZE">MAX_HEADER_SIZE</a></dt>
          
          <dd class="description"></dd>
          
        
          <dt><a name="OBJECT_SPACE_SUPPORTS_ALLOCATED_OBJECTS">OBJECT_SPACE_SUPPORTS_ALLOCATED_OBJECTS</a></dt>
          
          <dd class="description"></dd>
          
        
          <dt><a name="OBJECT_SPACE_SUPPORTS_COUNT_OBJECTS">OBJECT_SPACE_SUPPORTS_COUNT_OBJECTS</a></dt>
          
          <dd class="description"></dd>
          
        
          <dt><a name="OBJECT_SPACE_SUPPORTS_LIVE_OBJECTS">OBJECT_SPACE_SUPPORTS_LIVE_OBJECTS</a></dt>
          
          <dd class="description"></dd>
          
        
          <dt><a name="SOFT_TERMINATION_SIGNAL">SOFT_TERMINATION_SIGNAL</a></dt>
          
          <dd class="description"><p><a href="../Signal.html">Signal</a> which will cause the Rails application
to exit as soon as it’s done processing a request.</p></dd>
          
        
        </dl>
      </div>
      

      
      <!-- Attributes -->
      <div id="attribute-method-details" class="method-section section">
        <h3 class="section-header">Attributes</h3>

        
        <div id="connect_password-attribute-method" class="method-detail">
          <a name="connect_password"></a>
          
          <a name="connect_password="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">connect_password</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          <p>A password with which clients must authenticate. Default is
unauthenticated.</p>
          
          </div>
        </div>
        
        <div id="iterations-attribute-method" class="method-detail">
          <a name="iterations"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">iterations</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          <p>The number of times the main loop has iterated so far. Mostly useful for
unit test assertions.</p>
          
          </div>
        </div>
        
        <div id="memory_limit-attribute-method" class="method-detail">
          <a name="memory_limit"></a>
          
          <a name="memory_limit="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">memory_limit</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          <p>Specifies the maximum allowed memory usage, in MB. If after having
processed a request <a
href="AbstractRequestHandler.html">AbstractRequestHandler</a> detects that
memory usage has risen above this limit, then it will gracefully exit (that
is, exit after having processed all pending requests).</p>

<p>A value of 0 (the default) indicates that there’s no limit.</p>
          
          </div>
        </div>
        
        <div id="processed_requests-attribute-method" class="method-detail">
          <a name="processed_requests"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">processed_requests</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          <p>Number of requests processed so far. This includes requests that raised
exceptions.</p>
          
          </div>
        </div>
        
        <div id="server_sockets-attribute-method" class="method-detail">
          <a name="server_sockets"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">server_sockets</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          <p>A hash containing all server sockets that this request handler listens on.
The hash is in the form of:</p>

<pre>{
   name1 =&gt; [socket_address1, socket_type1, socket1],
   name2 =&gt; [socket_address2, socket_type2, socket2],
   ...
}</pre>

<p><tt>name</tt> is a Symbol. <tt>socket_addressx</tt> is the address of the
socket, <tt>socket_typex</tt> is the socket’s type (either ‘unix’ or
‘tcp’) and <tt>socketx</tt> is the actual socket <a
href="../IO.html">IO</a> objec. There’s guaranteed to be at least one
server socket, namely one with the name <tt>:main</tt>.</p>
          
          </div>
        </div>
        
        <div id="soft_termination_linger_time-attribute-method" class="method-detail">
          <a name="soft_termination_linger_time"></a>
          
          <a name="soft_termination_linger_time="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">soft_termination_linger_time</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          <p>If a soft termination signal was received, then the main loop will quit the
given amount of seconds after the last time a connection was accepted.
Defaults to 3 seconds.</p>
          
          </div>
        </div>
        
      </div><!-- attribute-method-details -->
      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="new-method" class="method-detail ">
          <a name="method-c-new"></a>

          
          <div class="method-heading">
            <span class="method-name">new</span><span
              class="method-args">(owner_pipe, options = {})</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Create a new RequestHandler with the given owner pipe. <tt>owner_pipe</tt>
must be the readable part of a pipe <a href="../IO.html">IO</a> object.</p>

<p>Additionally, the following options may be given:</p>
<ul><li>
<p><a
href="AbstractRequestHandler.html#attribute-i-memory_limit">memory_limit</a>:
Used to set the <tt><a
href="AbstractRequestHandler.html#attribute-i-memory_limit">memory_limit</a></tt>
attribute.</p>
</li><li>
<p>detach_key</p>
</li><li>
<p><a
href="AbstractRequestHandler.html#attribute-i-connect_password">connect_password</a></p>
</li><li>
<p>pool_account_username</p>
</li><li>
<p>pool_account_password_base64</p>
</li></ul>
            

            
            <div class="method-source-code" id="new-source">
<pre>
<span class="ruby-comment"># File lib/phusion_passenger/abstract_request_handler.rb, line 169</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">owner_pipe</span>, <span class="ruby-identifier">options</span> = {})
        <span class="ruby-ivar">@server_sockets</span> = {}
        
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">should_use_unix_sockets?</span>
                <span class="ruby-ivar">@main_socket_address</span>, <span class="ruby-ivar">@main_socket</span> = <span class="ruby-identifier">create_unix_socket_on_filesystem</span>
                <span class="ruby-ivar">@server_sockets</span>[<span class="ruby-value">:main</span>] = [<span class="ruby-ivar">@main_socket_address</span>, <span class="ruby-string">'unix'</span>, <span class="ruby-ivar">@main_socket</span>]
        <span class="ruby-keyword">else</span>
                <span class="ruby-ivar">@main_socket_address</span>, <span class="ruby-ivar">@main_socket</span> = <span class="ruby-identifier">create_tcp_socket</span>
                <span class="ruby-ivar">@server_sockets</span>[<span class="ruby-value">:main</span>] = [<span class="ruby-ivar">@main_socket_address</span>, <span class="ruby-string">'tcp'</span>, <span class="ruby-ivar">@main_socket</span>]
        <span class="ruby-keyword">end</span>
        
        <span class="ruby-ivar">@http_socket_address</span>, <span class="ruby-ivar">@http_socket</span> = <span class="ruby-identifier">create_tcp_socket</span>
        <span class="ruby-ivar">@server_sockets</span>[<span class="ruby-value">:http</span>] = [<span class="ruby-ivar">@http_socket_address</span>, <span class="ruby-string">'tcp'</span>, <span class="ruby-ivar">@http_socket</span>]
        
        <span class="ruby-ivar">@owner_pipe</span> = <span class="ruby-identifier">owner_pipe</span>
        <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">options</span>
        <span class="ruby-ivar">@previous_signal_handlers</span> = {}
        <span class="ruby-ivar">@main_loop_generation</span>  = <span class="ruby-value">0</span>
        <span class="ruby-ivar">@main_loop_thread_lock</span> = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-ivar">@main_loop_thread_cond</span> = <span class="ruby-constant">ConditionVariable</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-ivar">@memory_limit</span>          = <span class="ruby-identifier">options</span>[<span class="ruby-string">&quot;memory_limit&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
        <span class="ruby-ivar">@connect_password</span>      = <span class="ruby-identifier">options</span>[<span class="ruby-string">&quot;connect_password&quot;</span>]
        <span class="ruby-ivar">@detach_key</span>            = <span class="ruby-identifier">options</span>[<span class="ruby-string">&quot;detach_key&quot;</span>]
        <span class="ruby-ivar">@pool_account_username</span> = <span class="ruby-identifier">options</span>[<span class="ruby-string">&quot;pool_account_username&quot;</span>]
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-string">&quot;pool_account_password_base64&quot;</span>]
                <span class="ruby-ivar">@pool_account_password</span> = <span class="ruby-identifier">options</span>[<span class="ruby-string">&quot;pool_account_password_base64&quot;</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-string">'m'</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@analytics_logger</span>      = <span class="ruby-identifier">options</span>[<span class="ruby-string">&quot;analytics_logger&quot;</span>]
        <span class="ruby-ivar">@iterations</span>         = <span class="ruby-value">0</span>
        <span class="ruby-ivar">@processed_requests</span> = <span class="ruby-value">0</span>
        <span class="ruby-ivar">@soft_termination_linger_time</span> = <span class="ruby-value">3</span>
        <span class="ruby-ivar">@main_loop_running</span>  = <span class="ruby-keyword">false</span>
        <span class="ruby-ivar">@passenger_header</span>   = <span class="ruby-identifier">determine_passenger_header</span>
        
        <span class="ruby-ivar">@debugger</span> = <span class="ruby-ivar">@options</span>[<span class="ruby-string">&quot;debugger&quot;</span>]
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@debugger</span>
                <span class="ruby-ivar">@server_sockets</span>[<span class="ruby-value">:ruby_debug_cmd</span>] = [<span class="ruby-node">&quot;127.0.0.1:#{Debugger.cmd_port}&quot;</span>, <span class="ruby-string">'tcp'</span>]
                <span class="ruby-ivar">@server_sockets</span>[<span class="ruby-value">:ruby_debug_ctrl</span>] = [<span class="ruby-node">&quot;127.0.0.1:#{Debugger.ctrl_port}&quot;</span>, <span class="ruby-string">'tcp'</span>]
        <span class="ruby-keyword">end</span>
        
        <span class="ruby-comment">#############</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- new-source -->
            
          </div>

          

          
        </div><!-- new-method -->

      
      </div><!-- public-class-method-details -->
    
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="cleanup-method" class="method-detail ">
          <a name="method-i-cleanup"></a>

          
          <div class="method-heading">
            <span class="method-name">cleanup</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Clean up temporary stuff created by the request handler.</p>

<p>If the main loop was started by <a
href="AbstractRequestHandler.html#method-i-main_loop">#main_loop</a>, then
this method may only be called after the main loop has exited.</p>

<p>If the main loop was started by <a
href="AbstractRequestHandler.html#method-i-start_main_loop_thread">#start_main_loop_thread</a>,
then this method may be called at any time, and it will stop the main loop
thread.</p>
            

            
            <div class="method-source-code" id="cleanup-source">
<pre>
<span class="ruby-comment"># File lib/phusion_passenger/abstract_request_handler.rb, line 219</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cleanup</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@main_loop_thread</span>
                <span class="ruby-ivar">@main_loop_thread_lock</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword">do</span>
                        <span class="ruby-ivar">@graceful_termination_pipe</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">close</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-ivar">@main_loop_thread</span>.<span class="ruby-identifier">join</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@server_sockets</span>.<span class="ruby-identifier">each_value</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">address</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">socket</span> = <span class="ruby-identifier">value</span>
                <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'unix'</span>
                        <span class="ruby-constant">File</span>.<span class="ruby-identifier">unlink</span>(<span class="ruby-identifier">address</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@owner_pipe</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- cleanup-source -->
            
          </div>

          

          
        </div><!-- cleanup-method -->

      
        <div id="main_loop-method" class="method-detail ">
          <a name="method-i-main_loop"></a>

          
          <div class="method-heading">
            <span class="method-name">main_loop</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Enter the request handler’s main loop.</p>
            

            
            <div class="method-source-code" id="main_loop-source">
<pre>
<span class="ruby-comment"># File lib/phusion_passenger/abstract_request_handler.rb, line 242</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">main_loop</span>
        <span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;Entering request handler main loop&quot;</span>)
        <span class="ruby-identifier">reset_signal_handlers</span>
        <span class="ruby-keyword">begin</span>
                <span class="ruby-ivar">@graceful_termination_pipe</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
                <span class="ruby-ivar">@graceful_termination_pipe</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">close_on_exec!</span>
                <span class="ruby-ivar">@graceful_termination_pipe</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">close_on_exec!</span>
                
                <span class="ruby-ivar">@main_loop_thread_lock</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword">do</span>
                        <span class="ruby-ivar">@main_loop_generation</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
                        <span class="ruby-ivar">@main_loop_running</span> = <span class="ruby-keyword">true</span>
                        <span class="ruby-ivar">@main_loop_thread_cond</span>.<span class="ruby-identifier">broadcast</span>
                        
                        <span class="ruby-ivar">@select_timeout</span> = <span class="ruby-keyword">nil</span>
                        
                        <span class="ruby-ivar">@selectable_sockets</span> = []
                        <span class="ruby-ivar">@server_sockets</span>.<span class="ruby-identifier">each_value</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
                                <span class="ruby-identifier">socket</span> = <span class="ruby-identifier">value</span>[<span class="ruby-value">2</span>]
                                <span class="ruby-ivar">@selectable_sockets</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">socket</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">socket</span>
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-ivar">@selectable_sockets</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@owner_pipe</span>
                        <span class="ruby-ivar">@selectable_sockets</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@graceful_termination_pipe</span>[<span class="ruby-value">0</span>]
                <span class="ruby-keyword">end</span>
                
                <span class="ruby-identifier">install_useful_signal_handlers</span>
                <span class="ruby-identifier">socket_wrapper</span> = <span class="ruby-constant">Utils</span><span class="ruby-operator">::</span><span class="ruby-constant">UnseekableSocket</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-identifier">channel</span>        = <span class="ruby-constant">MessageChannel</span>.<span class="ruby-identifier">new</span>
                <span class="ruby-identifier">buffer</span>         = <span class="ruby-string">''</span>
                
                <span class="ruby-keyword">while</span> <span class="ruby-keyword">true</span>
                        <span class="ruby-ivar">@iterations</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">accept_and_process_next_request</span>(<span class="ruby-identifier">socket_wrapper</span>, <span class="ruby-identifier">channel</span>, <span class="ruby-identifier">buffer</span>)
                                <span class="ruby-identifier">trace</span>(<span class="ruby-value">2</span>, <span class="ruby-string">&quot;Request handler main loop exited normally&quot;</span>)
                                <span class="ruby-keyword">break</span>
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-ivar">@processed_requests</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">EOFError</span>
                <span class="ruby-comment"># Exit main loop.</span>
                <span class="ruby-identifier">trace</span>(<span class="ruby-value">2</span>, <span class="ruby-string">&quot;Request handler main loop interrupted by EOFError exception&quot;</span>)
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Interrupt</span>
                <span class="ruby-comment"># Exit main loop.</span>
                <span class="ruby-identifier">trace</span>(<span class="ruby-value">2</span>, <span class="ruby-string">&quot;Request handler main loop interrupted by Interrupt exception&quot;</span>)
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">SignalException</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">signal</span>
                <span class="ruby-identifier">trace</span>(<span class="ruby-value">2</span>, <span class="ruby-string">&quot;Request handler main loop interrupted by SignalException&quot;</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">signal</span>.<span class="ruby-identifier">message</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">HARD_TERMINATION_SIGNAL</span> <span class="ruby-operator">&amp;&amp;</span>
                   <span class="ruby-identifier">signal</span>.<span class="ruby-identifier">message</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">SOFT_TERMINATION_SIGNAL</span>
                        <span class="ruby-identifier">raise</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
                <span class="ruby-identifier">trace</span>(<span class="ruby-value">2</span>, <span class="ruby-node">&quot;Request handler main loop interrupted by #{e.class} exception&quot;</span>)
                <span class="ruby-identifier">raise</span>
        <span class="ruby-keyword">ensure</span>
                <span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;Exiting request handler main loop&quot;</span>)
                <span class="ruby-identifier">revert_signal_handlers</span>
                <span class="ruby-ivar">@main_loop_thread_lock</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword">do</span>
                        <span class="ruby-ivar">@graceful_termination_pipe</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">close</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
                        <span class="ruby-ivar">@graceful_termination_pipe</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">close</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
                        <span class="ruby-ivar">@selectable_sockets</span> = []
                        <span class="ruby-ivar">@main_loop_generation</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
                        <span class="ruby-ivar">@main_loop_running</span> = <span class="ruby-keyword">false</span>
                        <span class="ruby-ivar">@main_loop_thread_cond</span>.<span class="ruby-identifier">broadcast</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- main_loop-source -->
            
          </div>

          

          
        </div><!-- main_loop-method -->

      
        <div id="main_loop_running-3F-method" class="method-detail ">
          <a name="method-i-main_loop_running-3F"></a>

          
          <div class="method-heading">
            <span class="method-name">main_loop_running?</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Check whether the main loop’s currently running.</p>
            

            
            <div class="method-source-code" id="main_loop_running-3F-source">
<pre>
<span class="ruby-comment"># File lib/phusion_passenger/abstract_request_handler.rb, line 237</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">main_loop_running?</span>
        <span class="ruby-keyword">return</span> <span class="ruby-ivar">@main_loop_running</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- main_loop_running-3F-source -->
            
          </div>

          

          
        </div><!-- main_loop_running-3F-method -->

      
        <div id="soft_shutdown-method" class="method-detail ">
          <a name="method-i-soft_shutdown"></a>

          
          <div class="method-heading">
            <span class="method-name">soft_shutdown</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Remove this request handler from the application pool so that no new
connections will come in. Then make the main loop quit a few seconds after
the last time a connection came in. This all is to ensure that no
connections come in while we’re shutting down.</p>

<p>May only be called while the main loop is running. May be called from any
thread.</p>
            

            
            <div class="method-source-code" id="soft_shutdown-source">
<pre>
<span class="ruby-comment"># File lib/phusion_passenger/abstract_request_handler.rb, line 332</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">soft_shutdown</span>
        <span class="ruby-ivar">@select_timeout</span> = <span class="ruby-ivar">@soft_termination_linger_time</span>
        <span class="ruby-ivar">@graceful_termination_pipe</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">close</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@detach_key</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pool_account_username</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pool_account_password</span>
                <span class="ruby-identifier">client</span> = <span class="ruby-constant">MessageClient</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@pool_account_username</span>, <span class="ruby-ivar">@pool_account_password</span>)
                <span class="ruby-keyword">begin</span>
                        <span class="ruby-identifier">client</span>.<span class="ruby-identifier">detach</span>(<span class="ruby-ivar">@detach_key</span>)
                <span class="ruby-keyword">ensure</span>
                        <span class="ruby-identifier">client</span>.<span class="ruby-identifier">close</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- soft_shutdown-source -->
            
          </div>

          

          
        </div><!-- soft_shutdown-method -->

      
        <div id="start_main_loop_thread-method" class="method-detail ">
          <a name="method-i-start_main_loop_thread"></a>

          
          <div class="method-heading">
            <span class="method-name">start_main_loop_thread</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Start the main loop in a new thread. This thread will be stopped by <a
href="AbstractRequestHandler.html#method-i-cleanup">#cleanup</a>.</p>
            

            
            <div class="method-source-code" id="start_main_loop_thread-source">
<pre>
<span class="ruby-comment"># File lib/phusion_passenger/abstract_request_handler.rb, line 309</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">start_main_loop_thread</span>
        <span class="ruby-identifier">current_generation</span> = <span class="ruby-ivar">@main_loop_generation</span>
        <span class="ruby-ivar">@main_loop_thread</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span>
                <span class="ruby-keyword">begin</span>
                        <span class="ruby-identifier">main_loop</span>
                <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
                        <span class="ruby-identifier">print_exception</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>, <span class="ruby-identifier">e</span>)
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@main_loop_thread_lock</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword">do</span>
                <span class="ruby-keyword">while</span> <span class="ruby-ivar">@main_loop_generation</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">current_generation</span>
                        <span class="ruby-ivar">@main_loop_thread_cond</span>.<span class="ruby-identifier">wait</span>(<span class="ruby-ivar">@main_loop_thread_lock</span>)
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- start_main_loop_thread-source -->
            
          </div>

          

          
        </div><!-- start_main_loop_thread-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

