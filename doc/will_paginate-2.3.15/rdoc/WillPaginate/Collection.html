<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: WillPaginate::Collection</title>

  <link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

  <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../lib/will_paginate/collection_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/will_paginate/collection.rb">lib/will_paginate/collection.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"><a href="../Array.html">Array</a></p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-create">::create</a></li>
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-i-next_page">#next_page</a></li>
          
          <li><a href="#method-i-offset">#offset</a></li>
          
          <li><a href="#method-i-out_of_bounds-3F">#out_of_bounds?</a></li>
          
          <li><a href="#method-i-previous_page">#previous_page</a></li>
          
          <li><a href="#method-i-replace">#replace</a></li>
          
          <li><a href="#method-i-total_entries-3D">#total_entries=</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="../CHANGELOG_rdoc.html">CHANGELOG.rdoc</a></li>
        
          <li class="file"><a href="../LICENSE.html">LICENSE</a></li>
        
          <li class="file"><a href="../README_rdoc.html">README.rdoc</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../WillPaginate.html">WillPaginate</a></li>
        
          <li><a href="../WillPaginate/Collection.html">WillPaginate::Collection</a></li>
        
          <li><a href="../WillPaginate/Finder.html">WillPaginate::Finder</a></li>
        
          <li><a href="../WillPaginate/Finder/ClassMethods.html">WillPaginate::Finder::ClassMethods</a></li>
        
          <li><a href="../WillPaginate/InvalidPage.html">WillPaginate::InvalidPage</a></li>
        
          <li><a href="../WillPaginate/LinkRenderer.html">WillPaginate::LinkRenderer</a></li>
        
          <li><a href="../WillPaginate/NamedScope.html">WillPaginate::NamedScope</a></li>
        
          <li><a href="../WillPaginate/NamedScope/ClassMethods.html">WillPaginate::NamedScope::ClassMethods</a></li>
        
          <li><a href="../WillPaginate/NamedScope/Scope.html">WillPaginate::NamedScope::Scope</a></li>
        
          <li><a href="../WillPaginate/VERSION.html">WillPaginate::VERSION</a></li>
        
          <li><a href="../WillPaginate/ViewHelpers.html">WillPaginate::ViewHelpers</a></li>
        
          <li><a href="../Array.html">Array</a></li>
        
          <li><a href="../Object.html">Object</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">WillPaginate::Collection</h1>

    <div id="description" class="description">
      
<h1>The key to pagination</h1>

<p>Arrays returned from paginating finds are, in fact, instances of this
little class. You may think of <a
href="Collection.html">WillPaginate::Collection</a> as an ordinary array
with some extra properties. Those properties are used by view helpers to
generate correct page links.</p>

<p><a href="Collection.html">WillPaginate::Collection</a> also assists in
rolling out your own pagination solutions: see <tt>create</tt>.</p>

<p>If you are writing a library that provides a collection which you would
like to conform to this API, you donâ€™t have to copy these methods over;
simply make your plugin/gem dependant on this library and do:</p>

<pre>require 'will_paginate/collection'
# WillPaginate::Collection is now available for use</pre>

    </div><!-- description -->

    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      
      <!-- Attributes -->
      <div id="attribute-method-details" class="method-section section">
        <h3 class="section-header">Attributes</h3>

        
        <div id="current_page-attribute-method" class="method-detail">
          <a name="current_page"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">current_page</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="per_page-attribute-method" class="method-detail">
          <a name="per_page"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">per_page</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="total_entries-attribute-method" class="method-detail">
          <a name="total_entries"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">total_entries</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="total_pages-attribute-method" class="method-detail">
          <a name="total_pages"></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">total_pages</span><span
              class="attribute-access-type">[R]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
      </div><!-- attribute-method-details -->
      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="create-method" class="method-detail ">
          <a name="method-c-create"></a>

          
          <div class="method-heading">
            <span class="method-name">create</span><span
              class="method-args">(page, per_page, total = nil)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Just like <tt>new</tt>, but yields the object after instantiation and
returns it afterwards. This is very useful for manual pagination:</p>

<pre>@entries = WillPaginate::Collection.create(1, 10) do |pager|
  result = Post.find(:all, :limit =&gt; pager.per_page, :offset =&gt; pager.offset)
  # inject the result array into the paginated collection:
  pager.replace(result)

  unless pager.total_entries
    # the pager didn't manage to guess the total count, do it manually
    pager.total_entries = Post.count
  end
end</pre>

<p>The possibilities with this are endless. For another example, here is how
<a href="../WillPaginate.html">WillPaginate</a> used to define pagination
for <a href="../Array.html">Array</a> instances:</p>

<pre>Array.class_eval do
  def paginate(page = 1, per_page = 15)
    WillPaginate::Collection.create(page, per_page, size) do |pager|
      pager.replace self[pager.offset, pager.per_page].to_a
    end
  end
end</pre>

<p>The <a href="../Object.html#method-i-paginate">Array#paginate</a> API has
since then changed, but this still serves as a fine example of <a
href="Collection.html">WillPaginate::Collection</a> usage.</p>
            

            
            <div class="method-source-code" id="create-source">
<pre>
<span class="ruby-comment"># File lib/will_paginate/collection.rb, line 83</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">page</span>, <span class="ruby-identifier">per_page</span>, <span class="ruby-identifier">total</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">pager</span> = <span class="ruby-identifier">new</span>(<span class="ruby-identifier">page</span>, <span class="ruby-identifier">per_page</span>, <span class="ruby-identifier">total</span>)
  <span class="ruby-keyword">yield</span> <span class="ruby-identifier">pager</span>
  <span class="ruby-identifier">pager</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- create-source -->
            
          </div>

          

          
        </div><!-- create-method -->

      
        <div id="new-method" class="method-detail ">
          <a name="method-c-new"></a>

          
          <div class="method-heading">
            <span class="method-name">new</span><span
              class="method-args">(page, per_page, total = nil)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Arguments to the constructor are the current page number, per-page limit
and the total number of entries. The last argument is optional because it
is best to do lazy counting; in other words, count <b>conditionally</b>
after populating the collection using the <tt>replace</tt> method.</p>
            

            
            <div class="method-source-code" id="new-source">
<pre>
<span class="ruby-comment"># File lib/will_paginate/collection.rb, line 47</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">page</span>, <span class="ruby-identifier">per_page</span>, <span class="ruby-identifier">total</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-ivar">@current_page</span> = <span class="ruby-identifier">page</span>.<span class="ruby-identifier">to_i</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPage</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">page</span>, <span class="ruby-ivar">@current_page</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@current_page</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">1</span>
  <span class="ruby-ivar">@per_page</span> = <span class="ruby-identifier">per_page</span>.<span class="ruby-identifier">to_i</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;`per_page` setting cannot be less than 1 (#{@per_page} given)&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@per_page</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">1</span>
  
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">total_entries</span> = <span class="ruby-identifier">total</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">total</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- new-source -->
            
          </div>

          

          
        </div><!-- new-method -->

      
      </div><!-- public-class-method-details -->
    
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="next_page-method" class="method-detail ">
          <a name="method-i-next_page"></a>

          
          <div class="method-heading">
            <span class="method-name">next_page</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p><a href="Collection.html#attribute-i-current_page">current_page</a> + 1 or
nil if there is no next page</p>
            

            
            <div class="method-source-code" id="next_page-source">
<pre>
<span class="ruby-comment"># File lib/will_paginate/collection.rb, line 110</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">next_page</span>
  <span class="ruby-identifier">current_page</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">total_pages</span> <span class="ruby-operator">?</span> (<span class="ruby-identifier">current_page</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- next_page-source -->
            
          </div>

          

          
        </div><!-- next_page-method -->

      
        <div id="offset-method" class="method-detail ">
          <a name="method-i-offset"></a>

          
          <div class="method-heading">
            <span class="method-name">offset</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Current offset of the paginated collection. If weâ€™re on the first page,
it is always 0. If weâ€™re on the 2nd page and there are 30 entries per
page, the offset is 30. This property is useful if you want to render
ordinals side by side with records in the view: simply start with offset +
1.</p>
            

            
            <div class="method-source-code" id="offset-source">
<pre>
<span class="ruby-comment"># File lib/will_paginate/collection.rb, line 100</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">offset</span>
  (<span class="ruby-identifier">current_page</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) * <span class="ruby-identifier">per_page</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- offset-source -->
            
          </div>

          

          
        </div><!-- offset-method -->

      
        <div id="out_of_bounds-3F-method" class="method-detail ">
          <a name="method-i-out_of_bounds-3F"></a>

          
          <div class="method-heading">
            <span class="method-name">out_of_bounds?</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Helper method that is true when someone tries to fetch a page with a larger
number than the last page. Can be used in combination with flashes and
redirecting.</p>
            

            
            <div class="method-source-code" id="out_of_bounds-3F-source">
<pre>
<span class="ruby-comment"># File lib/will_paginate/collection.rb, line 92</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">out_of_bounds?</span>
  <span class="ruby-identifier">current_page</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">total_pages</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- out_of_bounds-3F-source -->
            
          </div>

          

          
        </div><!-- out_of_bounds-3F-method -->

      
        <div id="previous_page-method" class="method-detail ">
          <a name="method-i-previous_page"></a>

          
          <div class="method-heading">
            <span class="method-name">previous_page</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p><a href="Collection.html#attribute-i-current_page">current_page</a> - 1 or
nil if there is no previous page</p>
            

            
            <div class="method-source-code" id="previous_page-source">
<pre>
<span class="ruby-comment"># File lib/will_paginate/collection.rb, line 105</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">previous_page</span>
  <span class="ruby-identifier">current_page</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> (<span class="ruby-identifier">current_page</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- previous_page-source -->
            
          </div>

          

          
        </div><!-- previous_page-method -->

      
        <div id="replace-method" class="method-detail ">
          <a name="method-i-replace"></a>

          
          <div class="method-heading">
            <span class="method-name">replace</span><span
              class="method-args">(array)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>This is a magic wrapper for the original Array#replace method. It serves
for populating the paginated collection after initialization.</p>

<p>Why magic? Because it tries to guess the total number of entries judging by
the size of given array. If it is shorter than <tt><a
href="Collection.html#attribute-i-per_page">per_page</a></tt> limit, then
we know weâ€™re on the last page. This trick is very useful for avoiding
unnecessary hits to the database to do the counting after we fetched the
data for the current page.</p>

<p>However, after using <tt>replace</tt> you should always test the value of
<tt><a
href="Collection.html#attribute-i-total_entries">total_entries</a></tt> and
set it to a proper value if itâ€™s <tt>nil</tt>. See the example in
<tt>create</tt>.</p>
            

            
            <div class="method-source-code" id="replace-source">
<pre>
<span class="ruby-comment"># File lib/will_paginate/collection.rb, line 132</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">replace</span>(<span class="ruby-identifier">array</span>)
  <span class="ruby-identifier">result</span> = <span class="ruby-keyword">super</span>
  
  <span class="ruby-comment"># The collection is shorter then page limit? Rejoice, because</span>
  <span class="ruby-comment"># then we know that we are on the last page!</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">total_entries</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">per_page</span> <span class="ruby-keyword">and</span> (<span class="ruby-identifier">current_page</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">total_entries</span> = <span class="ruby-identifier">offset</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">length</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- replace-source -->
            
          </div>

          

          
        </div><!-- replace-method -->

      
        <div id="total_entries-3D-method" class="method-detail ">
          <a name="method-i-total_entries-3D"></a>

          
          <div class="method-heading">
            <span class="method-name">total_entries=</span><span
              class="method-args">(number)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>sets the <tt><a
href="Collection.html#attribute-i-total_entries">total_entries</a></tt>
property and calculates <tt><a
href="Collection.html#attribute-i-total_pages">total_pages</a></tt></p>
            

            
            <div class="method-source-code" id="total_entries-3D-source">
<pre>
<span class="ruby-comment"># File lib/will_paginate/collection.rb, line 115</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">total_entries=</span>(<span class="ruby-identifier">number</span>)
  <span class="ruby-ivar">@total_entries</span> = <span class="ruby-identifier">number</span>.<span class="ruby-identifier">to_i</span>
  <span class="ruby-ivar">@total_pages</span>   = (<span class="ruby-ivar">@total_entries</span> <span class="ruby-operator">/</span> <span class="ruby-identifier">per_page</span>.<span class="ruby-identifier">to_f</span>).<span class="ruby-identifier">ceil</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- total_entries-3D-source -->
            
          </div>

          

          
        </div><!-- total_entries-3D-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

